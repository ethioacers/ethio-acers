"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ai/route";
exports.ids = ["app/api/ai/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Cgemta%5COneDrive%5CDesktop%5CEthioAcers%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgemta%5COneDrive%5CDesktop%5CEthioAcers&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Cgemta%5COneDrive%5CDesktop%5CEthioAcers%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgemta%5COneDrive%5CDesktop%5CEthioAcers&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_gemta_OneDrive_Desktop_EthioAcers_app_api_ai_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/ai/route.ts */ \"(rsc)/./app/api/ai/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ai/route\",\n        pathname: \"/api/ai\",\n        filename: \"route\",\n        bundlePath: \"app/api/ai/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\gemta\\\\OneDrive\\\\Desktop\\\\EthioAcers\\\\app\\\\api\\\\ai\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_gemta_OneDrive_Desktop_EthioAcers_app_api_ai_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ai/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhaSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYWklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhaSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNnZW10YSU1Q09uZURyaXZlJTVDRGVza3RvcCU1Q0V0aGlvQWNlcnMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q2dlbXRhJTVDT25lRHJpdmUlNUNEZXNrdG9wJTVDRXRoaW9BY2VycyZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDdUI7QUFDcEc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ldGhpby1hY2Vycy8/YWUzMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxnZW10YVxcXFxPbmVEcml2ZVxcXFxEZXNrdG9wXFxcXEV0aGlvQWNlcnNcXFxcYXBwXFxcXGFwaVxcXFxhaVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYWkvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9haVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYWkvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxnZW10YVxcXFxPbmVEcml2ZVxcXFxEZXNrdG9wXFxcXEV0aGlvQWNlcnNcXFxcYXBwXFxcXGFwaVxcXFxhaVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvYWkvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Cgemta%5COneDrive%5CDesktop%5CEthioAcers%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgemta%5COneDrive%5CDesktop%5CEthioAcers&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/ai/route.ts":
/*!*****************************!*\
  !*** ./app/api/ai/route.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/supabase/server */ \"(rsc)/./lib/supabase/server.ts\");\n/* harmony import */ var _lib_gemini__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/gemini */ \"(rsc)/./lib/gemini.ts\");\n\n\n\n\n\nconst DAILY_AI_LIMIT = 5;\n// Use Node.js runtime so process.env (including .env.local) is available\nconst runtime = \"nodejs\";\n/** Fallback: read GEMINI_API_KEY from .env.local if Next didn't inject it */ function getGeminiApiKey() {\n    let key = (process.env.GEMINI_API_KEY ?? \"\").trim();\n    if (key) return key;\n    // Find project root (directory that contains package.json)\n    let dir = process.cwd();\n    for(let i = 0; i < 5; i++){\n        if ((0,fs__WEBPACK_IMPORTED_MODULE_1__.existsSync)((0,path__WEBPACK_IMPORTED_MODULE_2__.join)(dir, \"package.json\"))) {\n            const envPath = (0,path__WEBPACK_IMPORTED_MODULE_2__.join)(dir, \".env.local\");\n            if ((0,fs__WEBPACK_IMPORTED_MODULE_1__.existsSync)(envPath)) {\n                const content = (0,fs__WEBPACK_IMPORTED_MODULE_1__.readFileSync)(envPath, \"utf8\");\n                for (const line of content.split(/\\r?\\n/)){\n                    const m = line.match(/^\\s*GEMINI_API_KEY\\s*=\\s*(.+)/);\n                    if (m) {\n                        key = m[1].trim().replace(/^[\"']|[\"']$/g, \"\");\n                        if (key) return key;\n                    }\n                }\n            }\n            break;\n        }\n        dir = (0,path__WEBPACK_IMPORTED_MODULE_2__.join)(dir, \"..\");\n    }\n    return \"\";\n}\nasync function POST(request) {\n    const supabase = await (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_3__.createServerSupabaseClient)();\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Unauthorized\"\n        }, {\n            status: 401\n        });\n    }\n    let body;\n    try {\n        body = await request.json();\n    } catch  {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Invalid JSON body\"\n        }, {\n            status: 400\n        });\n    }\n    const { question, selectedAnswer, correctAnswer, subject } = body;\n    if (!question || !correctAnswer || !subject) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Missing question, correctAnswer, or subject\"\n        }, {\n            status: 400\n        });\n    }\n    const { data: profile, error: profileError } = await supabase.from(\"profiles\").select(\"ai_requests_today, ai_last_reset\").eq(\"id\", user.id).single();\n    if (profileError || !profile) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Profile not found\"\n        }, {\n            status: 404\n        });\n    }\n    const today = new Date().toISOString().split(\"T\")[0];\n    const lastReset = profile.ai_last_reset ?? null;\n    let requestsToday = Number(profile.ai_requests_today ?? 0);\n    if (lastReset !== today) {\n        await supabase.from(\"profiles\").update({\n            ai_requests_today: 0,\n            ai_last_reset: today\n        }).eq(\"id\", user.id);\n        requestsToday = 0;\n    }\n    if (requestsToday >= DAILY_AI_LIMIT) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Daily limit reached\",\n            message: \"You've used your 5 free explanations today. Come back tomorrow!\"\n        }, {\n            status: 429\n        });\n    }\n    let apiKey = getGeminiApiKey();\n    if (!apiKey) {\n        console.error(\"GEMINI_API_KEY is not set.\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"AI is not configured.\",\n            message: \"Set GEMINI_API_KEY in .env.local (same folder as package.json), then restart the dev server.\"\n        }, {\n            status: 500\n        });\n    }\n    process.env.GEMINI_API_KEY = apiKey;\n    let explanation;\n    try {\n        explanation = await (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_4__.explainAnswer)({\n            question,\n            selectedAnswer: selectedAnswer ?? \"\",\n            correctAnswer,\n            subject\n        });\n    } catch (err) {\n        const message = err instanceof Error ? err.message : String(err);\n        const isQuotaError = message.includes(\"429\") || message.includes(\"quota\") || message.includes(\"Too Many Requests\") || message.includes(\"rate limit\");\n        if (isQuotaError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"AI quota exceeded\",\n                message: \"You've hit the free-tier limit for AI. Wait a minute and try again, or check your quota at https://ai.google.dev/gemini-api/docs/rate-limits\"\n            }, {\n                status: 503\n            });\n        }\n        console.error(\"Gemini explainAnswer error:\", message, err);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to generate explanation\",\n            message:  true ? message : 0\n        }, {\n            status: 500\n        });\n    }\n    await supabase.from(\"profiles\").update({\n        ai_requests_today: requestsToday + 1\n    }).eq(\"id\", user.id);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        explanation\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2FpL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUEyQztBQUNHO0FBQ2xCO0FBQ3VDO0FBQ3RCO0FBRTdDLE1BQU1NLGlCQUFpQjtBQUV2Qix5RUFBeUU7QUFDbEUsTUFBTUMsVUFBVSxTQUFTO0FBRWhDLDJFQUEyRSxHQUMzRSxTQUFTQztJQUNQLElBQUlDLE1BQU0sQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyxjQUFjLElBQUksRUFBQyxFQUFHQyxJQUFJO0lBQ2pELElBQUlKLEtBQUssT0FBT0E7SUFDaEIsMkRBQTJEO0lBQzNELElBQUlLLE1BQU1KLFFBQVFLLEdBQUc7SUFDckIsSUFBSyxJQUFJQyxJQUFJLEdBQUdBLElBQUksR0FBR0EsSUFBSztRQUMxQixJQUFJZCw4Q0FBVUEsQ0FBQ0MsMENBQUlBLENBQUNXLEtBQUssa0JBQWtCO1lBQ3pDLE1BQU1HLFVBQVVkLDBDQUFJQSxDQUFDVyxLQUFLO1lBQzFCLElBQUlaLDhDQUFVQSxDQUFDZSxVQUFVO2dCQUN2QixNQUFNQyxVQUFVakIsZ0RBQVlBLENBQUNnQixTQUFTO2dCQUN0QyxLQUFLLE1BQU1FLFFBQVFELFFBQVFFLEtBQUssQ0FBQyxTQUFVO29CQUN6QyxNQUFNQyxJQUFJRixLQUFLRyxLQUFLLENBQUM7b0JBQ3JCLElBQUlELEdBQUc7d0JBQ0xaLE1BQU1ZLENBQUMsQ0FBQyxFQUFFLENBQUNSLElBQUksR0FBR1UsT0FBTyxDQUFDLGdCQUFnQjt3QkFDMUMsSUFBSWQsS0FBSyxPQUFPQTtvQkFDbEI7Z0JBQ0Y7WUFDRjtZQUNBO1FBQ0Y7UUFDQUssTUFBTVgsMENBQUlBLENBQUNXLEtBQUs7SUFDbEI7SUFDQSxPQUFPO0FBQ1Q7QUFFTyxlQUFlVSxLQUFLQyxPQUFnQjtJQUN6QyxNQUFNQyxXQUFXLE1BQU10QixnRkFBMEJBO0lBQ2pELE1BQU0sRUFDSnVCLE1BQU0sRUFBRUMsSUFBSSxFQUFFLEVBQ2YsR0FBRyxNQUFNRixTQUFTRyxJQUFJLENBQUNDLE9BQU87SUFFL0IsSUFBSSxDQUFDRixNQUFNO1FBQ1QsT0FBTzVCLHFEQUFZQSxDQUFDK0IsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBZSxHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUNwRTtJQUVBLElBQUlDO0lBQ0osSUFBSTtRQUNGQSxPQUFPLE1BQU1ULFFBQVFNLElBQUk7SUFDM0IsRUFBRSxPQUFNO1FBQ04sT0FBTy9CLHFEQUFZQSxDQUFDK0IsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBb0IsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDekU7SUFFQSxNQUFNLEVBQUVFLFFBQVEsRUFBRUMsY0FBYyxFQUFFQyxhQUFhLEVBQUVDLE9BQU8sRUFBRSxHQUFHSjtJQUM3RCxJQUFJLENBQUNDLFlBQVksQ0FBQ0UsaUJBQWlCLENBQUNDLFNBQVM7UUFDM0MsT0FBT3RDLHFEQUFZQSxDQUFDK0IsSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1FBQThDLEdBQ3ZEO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtJQUVBLE1BQU0sRUFBRU4sTUFBTVksT0FBTyxFQUFFUCxPQUFPUSxZQUFZLEVBQUUsR0FBRyxNQUFNZCxTQUNsRGUsSUFBSSxDQUFDLFlBQ0xDLE1BQU0sQ0FBQyxvQ0FDUEMsRUFBRSxDQUFDLE1BQU1mLEtBQUtnQixFQUFFLEVBQ2hCQyxNQUFNO0lBRVQsSUFBSUwsZ0JBQWdCLENBQUNELFNBQVM7UUFDNUIsT0FBT3ZDLHFEQUFZQSxDQUFDK0IsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBb0IsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDekU7SUFFQSxNQUFNYSxRQUFRLElBQUlDLE9BQU9DLFdBQVcsR0FBRzVCLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtJQUNwRCxNQUFNNkIsWUFBWSxRQUFTQyxhQUFhLElBQWU7SUFDdkQsSUFBSUMsZ0JBQWdCQyxPQUFPYixRQUFRYyxpQkFBaUIsSUFBSTtJQUV4RCxJQUFJSixjQUFjSCxPQUFPO1FBQ3ZCLE1BQU1wQixTQUNIZSxJQUFJLENBQUMsWUFDTGEsTUFBTSxDQUFDO1lBQUVELG1CQUFtQjtZQUFHSCxlQUFlSjtRQUFNLEdBQ3BESCxFQUFFLENBQUMsTUFBTWYsS0FBS2dCLEVBQUU7UUFDbkJPLGdCQUFnQjtJQUNsQjtJQUVBLElBQUlBLGlCQUFpQjdDLGdCQUFnQjtRQUNuQyxPQUFPTixxREFBWUEsQ0FBQytCLElBQUksQ0FDdEI7WUFBRUMsT0FBTztZQUF1QnVCLFNBQVM7UUFBa0UsR0FDM0c7WUFBRXRCLFFBQVE7UUFBSTtJQUVsQjtJQUVBLElBQUl1QixTQUFTaEQ7SUFDYixJQUFJLENBQUNnRCxRQUFRO1FBQ1hDLFFBQVF6QixLQUFLLENBQUM7UUFDZCxPQUFPaEMscURBQVlBLENBQUMrQixJQUFJLENBQ3RCO1lBQ0VDLE9BQU87WUFDUHVCLFNBQ0U7UUFDSixHQUNBO1lBQUV0QixRQUFRO1FBQUk7SUFFbEI7SUFDQXZCLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYyxHQUFHNEM7SUFFN0IsSUFBSUU7SUFDSixJQUFJO1FBQ0ZBLGNBQWMsTUFBTXJELDBEQUFhQSxDQUFDO1lBQ2hDOEI7WUFDQUMsZ0JBQWdCQSxrQkFBa0I7WUFDbENDO1lBQ0FDO1FBQ0Y7SUFDRixFQUFFLE9BQU9xQixLQUFLO1FBQ1osTUFBTUosVUFBVUksZUFBZUMsUUFBUUQsSUFBSUosT0FBTyxHQUFHTSxPQUFPRjtRQUM1RCxNQUFNRyxlQUNKUCxRQUFRUSxRQUFRLENBQUMsVUFDakJSLFFBQVFRLFFBQVEsQ0FBQyxZQUNqQlIsUUFBUVEsUUFBUSxDQUFDLHdCQUNqQlIsUUFBUVEsUUFBUSxDQUFDO1FBQ25CLElBQUlELGNBQWM7WUFDaEIsT0FBTzlELHFEQUFZQSxDQUFDK0IsSUFBSSxDQUN0QjtnQkFDRUMsT0FBTztnQkFDUHVCLFNBQ0U7WUFDSixHQUNBO2dCQUFFdEIsUUFBUTtZQUFJO1FBRWxCO1FBQ0F3QixRQUFRekIsS0FBSyxDQUFDLCtCQUErQnVCLFNBQVNJO1FBQ3RELE9BQU8zRCxxREFBWUEsQ0FBQytCLElBQUksQ0FDdEI7WUFDRUMsT0FBTztZQUNQdUIsU0FBUzdDLEtBQXNDLEdBQUc2QyxVQUFVUyxDQUFTQTtRQUN2RSxHQUNBO1lBQUUvQixRQUFRO1FBQUk7SUFFbEI7SUFFQSxNQUFNUCxTQUNIZSxJQUFJLENBQUMsWUFDTGEsTUFBTSxDQUFDO1FBQUVELG1CQUFtQkYsZ0JBQWdCO0lBQUUsR0FDOUNSLEVBQUUsQ0FBQyxNQUFNZixLQUFLZ0IsRUFBRTtJQUVuQixPQUFPNUMscURBQVlBLENBQUMrQixJQUFJLENBQUM7UUFBRTJCO0lBQVk7QUFDekMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ldGhpby1hY2Vycy8uL2FwcC9hcGkvYWkvcm91dGUudHM/MGIyNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcclxuaW1wb3J0IHsgcmVhZEZpbGVTeW5jLCBleGlzdHNTeW5jIH0gZnJvbSBcImZzXCI7XHJcbmltcG9ydCB7IGpvaW4gfSBmcm9tIFwicGF0aFwiO1xyXG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXJTdXBhYmFzZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcclxuaW1wb3J0IHsgZXhwbGFpbkFuc3dlciB9IGZyb20gXCJAL2xpYi9nZW1pbmlcIjtcclxuXHJcbmNvbnN0IERBSUxZX0FJX0xJTUlUID0gNTtcclxuXHJcbi8vIFVzZSBOb2RlLmpzIHJ1bnRpbWUgc28gcHJvY2Vzcy5lbnYgKGluY2x1ZGluZyAuZW52LmxvY2FsKSBpcyBhdmFpbGFibGVcclxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSBcIm5vZGVqc1wiO1xyXG5cclxuLyoqIEZhbGxiYWNrOiByZWFkIEdFTUlOSV9BUElfS0VZIGZyb20gLmVudi5sb2NhbCBpZiBOZXh0IGRpZG4ndCBpbmplY3QgaXQgKi9cclxuZnVuY3Rpb24gZ2V0R2VtaW5pQXBpS2V5KCk6IHN0cmluZyB7XHJcbiAgbGV0IGtleSA9IChwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSA/PyBcIlwiKS50cmltKCk7XHJcbiAgaWYgKGtleSkgcmV0dXJuIGtleTtcclxuICAvLyBGaW5kIHByb2plY3Qgcm9vdCAoZGlyZWN0b3J5IHRoYXQgY29udGFpbnMgcGFja2FnZS5qc29uKVxyXG4gIGxldCBkaXIgPSBwcm9jZXNzLmN3ZCgpO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XHJcbiAgICBpZiAoZXhpc3RzU3luYyhqb2luKGRpciwgXCJwYWNrYWdlLmpzb25cIikpKSB7XHJcbiAgICAgIGNvbnN0IGVudlBhdGggPSBqb2luKGRpciwgXCIuZW52LmxvY2FsXCIpO1xyXG4gICAgICBpZiAoZXhpc3RzU3luYyhlbnZQYXRoKSkge1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSByZWFkRmlsZVN5bmMoZW52UGF0aCwgXCJ1dGY4XCIpO1xyXG4gICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBjb250ZW50LnNwbGl0KC9cXHI/XFxuLykpIHtcclxuICAgICAgICAgIGNvbnN0IG0gPSBsaW5lLm1hdGNoKC9eXFxzKkdFTUlOSV9BUElfS0VZXFxzKj1cXHMqKC4rKS8pO1xyXG4gICAgICAgICAgaWYgKG0pIHtcclxuICAgICAgICAgICAga2V5ID0gbVsxXS50cmltKCkucmVwbGFjZSgvXltcIiddfFtcIiddJC9nLCBcIlwiKTtcclxuICAgICAgICAgICAgaWYgKGtleSkgcmV0dXJuIGtleTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICBkaXIgPSBqb2luKGRpciwgXCIuLlwiKTtcclxuICB9XHJcbiAgcmV0dXJuIFwiXCI7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcclxuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZVNlcnZlclN1cGFiYXNlQ2xpZW50KCk7XHJcbiAgY29uc3Qge1xyXG4gICAgZGF0YTogeyB1c2VyIH0sXHJcbiAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xyXG5cclxuICBpZiAoIXVzZXIpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgfVxyXG5cclxuICBsZXQgYm9keTogeyBxdWVzdGlvbjogc3RyaW5nOyBzZWxlY3RlZEFuc3dlcjogc3RyaW5nOyBjb3JyZWN0QW5zd2VyOiBzdHJpbmc7IHN1YmplY3Q6IHN0cmluZyB9O1xyXG4gIHRyeSB7XHJcbiAgICBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgfSBjYXRjaCB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJJbnZhbGlkIEpTT04gYm9keVwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB7IHF1ZXN0aW9uLCBzZWxlY3RlZEFuc3dlciwgY29ycmVjdEFuc3dlciwgc3ViamVjdCB9ID0gYm9keTtcclxuICBpZiAoIXF1ZXN0aW9uIHx8ICFjb3JyZWN0QW5zd2VyIHx8ICFzdWJqZWN0KSB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6IFwiTWlzc2luZyBxdWVzdGlvbiwgY29ycmVjdEFuc3dlciwgb3Igc3ViamVjdFwiIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKFwicHJvZmlsZXNcIilcclxuICAgIC5zZWxlY3QoXCJhaV9yZXF1ZXN0c190b2RheSwgYWlfbGFzdF9yZXNldFwiKVxyXG4gICAgLmVxKFwiaWRcIiwgdXNlci5pZClcclxuICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgaWYgKHByb2ZpbGVFcnJvciB8fCAhcHJvZmlsZSkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiUHJvZmlsZSBub3QgZm91bmRcIiB9LCB7IHN0YXR1czogNDA0IH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoXCJUXCIpWzBdO1xyXG4gIGNvbnN0IGxhc3RSZXNldCA9IChwcm9maWxlLmFpX2xhc3RfcmVzZXQgYXMgc3RyaW5nKSA/PyBudWxsO1xyXG4gIGxldCByZXF1ZXN0c1RvZGF5ID0gTnVtYmVyKHByb2ZpbGUuYWlfcmVxdWVzdHNfdG9kYXkgPz8gMCk7XHJcblxyXG4gIGlmIChsYXN0UmVzZXQgIT09IHRvZGF5KSB7XHJcbiAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbShcInByb2ZpbGVzXCIpXHJcbiAgICAgIC51cGRhdGUoeyBhaV9yZXF1ZXN0c190b2RheTogMCwgYWlfbGFzdF9yZXNldDogdG9kYXkgfSlcclxuICAgICAgLmVxKFwiaWRcIiwgdXNlci5pZCk7XHJcbiAgICByZXF1ZXN0c1RvZGF5ID0gMDtcclxuICB9XHJcblxyXG4gIGlmIChyZXF1ZXN0c1RvZGF5ID49IERBSUxZX0FJX0xJTUlUKSB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6IFwiRGFpbHkgbGltaXQgcmVhY2hlZFwiLCBtZXNzYWdlOiBcIllvdSd2ZSB1c2VkIHlvdXIgNSBmcmVlIGV4cGxhbmF0aW9ucyB0b2RheS4gQ29tZSBiYWNrIHRvbW9ycm93IVwiIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA0MjkgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGxldCBhcGlLZXkgPSBnZXRHZW1pbmlBcGlLZXkoKTtcclxuICBpZiAoIWFwaUtleSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkdFTUlOSV9BUElfS0VZIGlzIG5vdCBzZXQuXCIpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgZXJyb3I6IFwiQUkgaXMgbm90IGNvbmZpZ3VyZWQuXCIsXHJcbiAgICAgICAgbWVzc2FnZTpcclxuICAgICAgICAgIFwiU2V0IEdFTUlOSV9BUElfS0VZIGluIC5lbnYubG9jYWwgKHNhbWUgZm9sZGVyIGFzIHBhY2thZ2UuanNvbiksIHRoZW4gcmVzdGFydCB0aGUgZGV2IHNlcnZlci5cIixcclxuICAgICAgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxuICBwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSA9IGFwaUtleTtcclxuXHJcbiAgbGV0IGV4cGxhbmF0aW9uOiBzdHJpbmc7XHJcbiAgdHJ5IHtcclxuICAgIGV4cGxhbmF0aW9uID0gYXdhaXQgZXhwbGFpbkFuc3dlcih7XHJcbiAgICAgIHF1ZXN0aW9uLFxyXG4gICAgICBzZWxlY3RlZEFuc3dlcjogc2VsZWN0ZWRBbnN3ZXIgPz8gXCJcIixcclxuICAgICAgY29ycmVjdEFuc3dlcixcclxuICAgICAgc3ViamVjdCxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc3QgbWVzc2FnZSA9IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiBTdHJpbmcoZXJyKTtcclxuICAgIGNvbnN0IGlzUXVvdGFFcnJvciA9XHJcbiAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoXCI0MjlcIikgfHxcclxuICAgICAgbWVzc2FnZS5pbmNsdWRlcyhcInF1b3RhXCIpIHx8XHJcbiAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoXCJUb28gTWFueSBSZXF1ZXN0c1wiKSB8fFxyXG4gICAgICBtZXNzYWdlLmluY2x1ZGVzKFwicmF0ZSBsaW1pdFwiKTtcclxuICAgIGlmIChpc1F1b3RhRXJyb3IpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGVycm9yOiBcIkFJIHF1b3RhIGV4Y2VlZGVkXCIsXHJcbiAgICAgICAgICBtZXNzYWdlOlxyXG4gICAgICAgICAgICBcIllvdSd2ZSBoaXQgdGhlIGZyZWUtdGllciBsaW1pdCBmb3IgQUkuIFdhaXQgYSBtaW51dGUgYW5kIHRyeSBhZ2Fpbiwgb3IgY2hlY2sgeW91ciBxdW90YSBhdCBodHRwczovL2FpLmdvb2dsZS5kZXYvZ2VtaW5pLWFwaS9kb2NzL3JhdGUtbGltaXRzXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAzIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIGNvbnNvbGUuZXJyb3IoXCJHZW1pbmkgZXhwbGFpbkFuc3dlciBlcnJvcjpcIiwgbWVzc2FnZSwgZXJyKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAge1xyXG4gICAgICAgIGVycm9yOiBcIkZhaWxlZCB0byBnZW5lcmF0ZSBleHBsYW5hdGlvblwiLFxyXG4gICAgICAgIG1lc3NhZ2U6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCIgPyBtZXNzYWdlIDogdW5kZWZpbmVkLFxyXG4gICAgICB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oXCJwcm9maWxlc1wiKVxyXG4gICAgLnVwZGF0ZSh7IGFpX3JlcXVlc3RzX3RvZGF5OiByZXF1ZXN0c1RvZGF5ICsgMSB9KVxyXG4gICAgLmVxKFwiaWRcIiwgdXNlci5pZCk7XHJcblxyXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGV4cGxhbmF0aW9uIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJyZWFkRmlsZVN5bmMiLCJleGlzdHNTeW5jIiwiam9pbiIsImNyZWF0ZVNlcnZlclN1cGFiYXNlQ2xpZW50IiwiZXhwbGFpbkFuc3dlciIsIkRBSUxZX0FJX0xJTUlUIiwicnVudGltZSIsImdldEdlbWluaUFwaUtleSIsImtleSIsInByb2Nlc3MiLCJlbnYiLCJHRU1JTklfQVBJX0tFWSIsInRyaW0iLCJkaXIiLCJjd2QiLCJpIiwiZW52UGF0aCIsImNvbnRlbnQiLCJsaW5lIiwic3BsaXQiLCJtIiwibWF0Y2giLCJyZXBsYWNlIiwiUE9TVCIsInJlcXVlc3QiLCJzdXBhYmFzZSIsImRhdGEiLCJ1c2VyIiwiYXV0aCIsImdldFVzZXIiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJib2R5IiwicXVlc3Rpb24iLCJzZWxlY3RlZEFuc3dlciIsImNvcnJlY3RBbnN3ZXIiLCJzdWJqZWN0IiwicHJvZmlsZSIsInByb2ZpbGVFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsImlkIiwic2luZ2xlIiwidG9kYXkiLCJEYXRlIiwidG9JU09TdHJpbmciLCJsYXN0UmVzZXQiLCJhaV9sYXN0X3Jlc2V0IiwicmVxdWVzdHNUb2RheSIsIk51bWJlciIsImFpX3JlcXVlc3RzX3RvZGF5IiwidXBkYXRlIiwibWVzc2FnZSIsImFwaUtleSIsImNvbnNvbGUiLCJleHBsYW5hdGlvbiIsImVyciIsIkVycm9yIiwiU3RyaW5nIiwiaXNRdW90YUVycm9yIiwiaW5jbHVkZXMiLCJ1bmRlZmluZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/ai/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/gemini.ts":
/*!***********************!*\
  !*** ./lib/gemini.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   explainAnswer: () => (/* binding */ explainAnswer)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n\n/**\r\n * Calls Gemini to explain why the correct answer is right.\r\n * Used only server-side (API route); GEMINI_API_KEY must not be exposed to the client.\r\n */ async function explainAnswer(input) {\n    const apiKey = (process.env.GEMINI_API_KEY ?? \"\").trim();\n    if (!apiKey) {\n        throw new Error(\"GEMINI_API_KEY is not set in environment\");\n    }\n    const genAI = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(apiKey);\n    // Use Flash-Lite for better free-tier quota (15 RPM, 1000 RPD); fallback to 2.5 Flash if needed\n    const model = genAI.getGenerativeModel({\n        model: \"gemini-2.5-flash-lite\"\n    });\n    const prompt = `You are a friendly tutor helping a high school student (Ethiopian curriculum, subject: ${input.subject}).\r\n\r\nThe student got this question wrong. Explain briefly why the correct answer is right in a simple, student-friendly way (2â€“4 sentences). Do not be condescending.\r\n\r\nQuestion: ${input.question}\r\nWhat they chose: ${input.selectedAnswer}\r\nCorrect answer: ${input.correctAnswer}\r\n\r\nReply with only the explanation, no labels or extra text.`;\n    const result = await model.generateContent(prompt);\n    const response = result.response;\n    // .text() is a method; it throws if the prompt or candidate was blocked\n    const text = response.text().trim();\n    return text || \"Sorry, I couldn't generate an explanation right now.\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZ2VtaW5pLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQTJEO0FBUzNEOzs7Q0FHQyxHQUNNLGVBQWVDLGNBQWNDLEtBQW1CO0lBQ3JELE1BQU1DLFNBQVMsQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyxjQUFjLElBQUksRUFBQyxFQUFHQyxJQUFJO0lBQ3RELElBQUksQ0FBQ0osUUFBUTtRQUNYLE1BQU0sSUFBSUssTUFBTTtJQUNsQjtJQUVBLE1BQU1DLFFBQVEsSUFBSVQscUVBQWtCQSxDQUFDRztJQUNyQyxnR0FBZ0c7SUFDaEcsTUFBTU8sUUFBUUQsTUFBTUUsa0JBQWtCLENBQUM7UUFBRUQsT0FBTztJQUF3QjtJQUV4RSxNQUFNRSxTQUFTLENBQUMsdUZBQXVGLEVBQUVWLE1BQU1XLE9BQU8sQ0FBQzs7OztVQUkvRyxFQUFFWCxNQUFNWSxRQUFRLENBQUM7aUJBQ1YsRUFBRVosTUFBTWEsY0FBYyxDQUFDO2dCQUN4QixFQUFFYixNQUFNYyxhQUFhLENBQUM7O3lEQUVtQixDQUFDO0lBRXhELE1BQU1DLFNBQVMsTUFBTVAsTUFBTVEsZUFBZSxDQUFDTjtJQUMzQyxNQUFNTyxXQUFXRixPQUFPRSxRQUFRO0lBQ2hDLHdFQUF3RTtJQUN4RSxNQUFNQyxPQUFPRCxTQUFTQyxJQUFJLEdBQUdiLElBQUk7SUFDakMsT0FBT2EsUUFBUTtBQUNqQiIsInNvdXJjZXMiOlsid2VicGFjazovL2V0aGlvLWFjZXJzLy4vbGliL2dlbWluaS50cz9iNjM1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdvb2dsZUdlbmVyYXRpdmVBSSB9IGZyb20gXCJAZ29vZ2xlL2dlbmVyYXRpdmUtYWlcIjtcclxuXHJcbmV4cG9ydCB0eXBlIEV4cGxhaW5JbnB1dCA9IHtcclxuICBxdWVzdGlvbjogc3RyaW5nO1xyXG4gIHNlbGVjdGVkQW5zd2VyOiBzdHJpbmc7XHJcbiAgY29ycmVjdEFuc3dlcjogc3RyaW5nO1xyXG4gIHN1YmplY3Q6IHN0cmluZztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDYWxscyBHZW1pbmkgdG8gZXhwbGFpbiB3aHkgdGhlIGNvcnJlY3QgYW5zd2VyIGlzIHJpZ2h0LlxyXG4gKiBVc2VkIG9ubHkgc2VydmVyLXNpZGUgKEFQSSByb3V0ZSk7IEdFTUlOSV9BUElfS0VZIG11c3Qgbm90IGJlIGV4cG9zZWQgdG8gdGhlIGNsaWVudC5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBsYWluQW5zd2VyKGlucHV0OiBFeHBsYWluSW5wdXQpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIGNvbnN0IGFwaUtleSA9IChwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSA/PyBcIlwiKS50cmltKCk7XHJcbiAgaWYgKCFhcGlLZXkpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkdFTUlOSV9BUElfS0VZIGlzIG5vdCBzZXQgaW4gZW52aXJvbm1lbnRcIik7XHJcbiAgfVxyXG5cclxuICBjb25zdCBnZW5BSSA9IG5ldyBHb29nbGVHZW5lcmF0aXZlQUkoYXBpS2V5KTtcclxuICAvLyBVc2UgRmxhc2gtTGl0ZSBmb3IgYmV0dGVyIGZyZWUtdGllciBxdW90YSAoMTUgUlBNLCAxMDAwIFJQRCk7IGZhbGxiYWNrIHRvIDIuNSBGbGFzaCBpZiBuZWVkZWRcclxuICBjb25zdCBtb2RlbCA9IGdlbkFJLmdldEdlbmVyYXRpdmVNb2RlbCh7IG1vZGVsOiBcImdlbWluaS0yLjUtZmxhc2gtbGl0ZVwiIH0pO1xyXG5cclxuICBjb25zdCBwcm9tcHQgPSBgWW91IGFyZSBhIGZyaWVuZGx5IHR1dG9yIGhlbHBpbmcgYSBoaWdoIHNjaG9vbCBzdHVkZW50IChFdGhpb3BpYW4gY3VycmljdWx1bSwgc3ViamVjdDogJHtpbnB1dC5zdWJqZWN0fSkuXHJcblxyXG5UaGUgc3R1ZGVudCBnb3QgdGhpcyBxdWVzdGlvbiB3cm9uZy4gRXhwbGFpbiBicmllZmx5IHdoeSB0aGUgY29ycmVjdCBhbnN3ZXIgaXMgcmlnaHQgaW4gYSBzaW1wbGUsIHN0dWRlbnQtZnJpZW5kbHkgd2F5ICgy4oCTNCBzZW50ZW5jZXMpLiBEbyBub3QgYmUgY29uZGVzY2VuZGluZy5cclxuXHJcblF1ZXN0aW9uOiAke2lucHV0LnF1ZXN0aW9ufVxyXG5XaGF0IHRoZXkgY2hvc2U6ICR7aW5wdXQuc2VsZWN0ZWRBbnN3ZXJ9XHJcbkNvcnJlY3QgYW5zd2VyOiAke2lucHV0LmNvcnJlY3RBbnN3ZXJ9XHJcblxyXG5SZXBseSB3aXRoIG9ubHkgdGhlIGV4cGxhbmF0aW9uLCBubyBsYWJlbHMgb3IgZXh0cmEgdGV4dC5gO1xyXG5cclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBtb2RlbC5nZW5lcmF0ZUNvbnRlbnQocHJvbXB0KTtcclxuICBjb25zdCByZXNwb25zZSA9IHJlc3VsdC5yZXNwb25zZTtcclxuICAvLyAudGV4dCgpIGlzIGEgbWV0aG9kOyBpdCB0aHJvd3MgaWYgdGhlIHByb21wdCBvciBjYW5kaWRhdGUgd2FzIGJsb2NrZWRcclxuICBjb25zdCB0ZXh0ID0gcmVzcG9uc2UudGV4dCgpLnRyaW0oKTtcclxuICByZXR1cm4gdGV4dCB8fCBcIlNvcnJ5LCBJIGNvdWxkbid0IGdlbmVyYXRlIGFuIGV4cGxhbmF0aW9uIHJpZ2h0IG5vdy5cIjtcclxufVxyXG4iXSwibmFtZXMiOlsiR29vZ2xlR2VuZXJhdGl2ZUFJIiwiZXhwbGFpbkFuc3dlciIsImlucHV0IiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkdFTUlOSV9BUElfS0VZIiwidHJpbSIsIkVycm9yIiwiZ2VuQUkiLCJtb2RlbCIsImdldEdlbmVyYXRpdmVNb2RlbCIsInByb21wdCIsInN1YmplY3QiLCJxdWVzdGlvbiIsInNlbGVjdGVkQW5zd2VyIiwiY29ycmVjdEFuc3dlciIsInJlc3VsdCIsImdlbmVyYXRlQ29udGVudCIsInJlc3BvbnNlIiwidGV4dCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/gemini.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/server.ts":
/*!********************************!*\
  !*** ./lib/supabase/server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createServerSupabaseClient: () => (/* binding */ createServerSupabaseClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\nasync function createServerSupabaseClient() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://cbwrabiufxdljbbwnlyf.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNid3JhYml1ZnhkbGpiYndubHlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3MzkxMDQsImV4cCI6MjA4NzMxNTEwNH0.KgxfhyKpuOZktMbDP7KAJOG8n8NtfP1qVy95Nx-fpJg\", {\n        cookies: {\n            getAll () {\n                return cookieStore.getAll();\n            },\n            setAll (cookiesToSet) {\n                try {\n                    cookiesToSet.forEach(({ name, value, options })=>cookieStore.set(name, value, options));\n                } catch  {\n                // Ignore in Server Components\n                }\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Uvc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFtRDtBQUNaO0FBRWhDLGVBQWVFO0lBQ3BCLE1BQU1DLGNBQWMsTUFBTUYscURBQU9BO0lBRWpDLE9BQU9ELGlFQUFrQkEsQ0FDdkJJLDBDQUFvQyxFQUNwQ0Esa05BQXlDLEVBQ3pDO1FBQ0VILFNBQVM7WUFDUE87Z0JBQ0UsT0FBT0wsWUFBWUssTUFBTTtZQUMzQjtZQUNBQyxRQUFPQyxZQUFZO2dCQUNqQixJQUFJO29CQUNGQSxhQUFhQyxPQUFPLENBQUMsQ0FBQyxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRUMsT0FBTyxFQUFFLEdBQzVDWCxZQUFZWSxHQUFHLENBQUNILE1BQU1DLE9BQU9DO2dCQUVqQyxFQUFFLE9BQU07Z0JBQ04sOEJBQThCO2dCQUNoQztZQUNGO1FBQ0Y7SUFDRjtBQUVKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXRoaW8tYWNlcnMvLi9saWIvc3VwYWJhc2Uvc2VydmVyLnRzPzY2MjUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zc3JcIjtcclxuaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIjtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVTZXJ2ZXJTdXBhYmFzZUNsaWVudCgpIHtcclxuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKTtcclxuXHJcbiAgcmV0dXJuIGNyZWF0ZVNlcnZlckNsaWVudChcclxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXHJcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXHJcbiAgICB7XHJcbiAgICAgIGNvb2tpZXM6IHtcclxuICAgICAgICBnZXRBbGwoKSB7XHJcbiAgICAgICAgICByZXR1cm4gY29va2llU3RvcmUuZ2V0QWxsKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRBbGwoY29va2llc1RvU2V0KSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb29raWVzVG9TZXQuZm9yRWFjaCgoeyBuYW1lLCB2YWx1ZSwgb3B0aW9ucyB9KSA9PlxyXG4gICAgICAgICAgICAgIGNvb2tpZVN0b3JlLnNldChuYW1lLCB2YWx1ZSwgb3B0aW9ucylcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgICAgICAvLyBJZ25vcmUgaW4gU2VydmVyIENvbXBvbmVudHNcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuIl0sIm5hbWVzIjpbImNyZWF0ZVNlcnZlckNsaWVudCIsImNvb2tpZXMiLCJjcmVhdGVTZXJ2ZXJTdXBhYmFzZUNsaWVudCIsImNvb2tpZVN0b3JlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZ2V0QWxsIiwic2V0QWxsIiwiY29va2llc1RvU2V0IiwiZm9yRWFjaCIsIm5hbWUiLCJ2YWx1ZSIsIm9wdGlvbnMiLCJzZXQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/cookie","vendor-chunks/@google"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Cgemta%5COneDrive%5CDesktop%5CEthioAcers%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgemta%5COneDrive%5CDesktop%5CEthioAcers&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();